<script src="jquery.min.js"></script>
<script src="void.jsonld"></script>


<style>
.circle {
    z-index: 1;
    position: absolute;
}
.circle .inner
{
    height: 100px;
    width: 100px;
    display: table-cell;
    text-align: center;
    vertical-align: middle;
    border-radius: 50%;
    background: #fff;
    border: 1px solid #316CC3;
    font-size: 14px;
    font-family: Tahoma;

-webkit-box-shadow: 10px 10px 51px -29px rgba(0,0,0,0.75);
-moz-box-shadow: 10px 10px 51px -29px rgba(0,0,0,0.75);
box-shadow: 10px 10px 51px -29px rgba(0,0,0,0.75);
}
.arrow {
width: 120px;
height: 6px;
position: absolute;

}

.line {
width: 100%;
background: #000;
height: 1px;
top: 50%;
margin-top: -0.5px;
position: absolute;
}
.point {    
width: 0;
height: 0;
border-top: 3px solid transparent;
border-bottom: 3px solid transparent;
border-left: 14px solid #000;
position: absolute;

}
.point.right {
right: -5px;
}
.point.left {
transform: rotate(180deg);
-ms-transform: rotate(180deg);
-webkit-transform: rotate(180deg);
left: -5px;
}
</style>
<script>
function createCircle(text, zoom) {
    var $circle = $('#tmpl .circle').clone();
    $circle.find('.inner').text(text);
    if(zoom) {
        $circle.css({zoom:zoom});
    }
    return $circle;
}
function getCenter($circle) {
    var pos = $circle.position();

    var width = $circle.width();
    var height = $circle.height();

    return { top: (pos.top + (height / 2)), left: (pos.left + (width/2)) };
}
function connect($c1, $c2, color, thickness) {
    var center1 = getCenter($c1);
    var center2 = getCenter($c2);

    // bottom right
    var x1 = center1.left;
    var y1 = center1.top;
    // top right
    var x2 = center2.left;
    var y2 = center2.top;
    // distance
    var length = Math.sqrt(((x2-x1) * (x2-x1)) + ((y2-y1) * (y2-y1)));
    // center
    var cx = ((x1 + x2) / 2) - (length / 2);
    var cy = ((y1 + y2) / 2) - (thickness / 2);
    // angle
    var angle = Math.atan2((y1-y2),(x1-x2))*(180/Math.PI);
    // make arrow
    var $arrow = $("<div class='arrow' style='padding:0px; margin:0px; position:absolute; left:" + cx + "px; top:" + cy + "px; width:" + length + "px; -moz-transform:rotate(" + angle + "deg); -webkit-transform:rotate(" + angle + "deg); -o-transform:rotate(" + angle + "deg); -ms-transform:rotate(" + angle + "deg); transform:rotate(" + angle + "deg);'><div class='line'></div><div class='point right' style='right: "+(($c2.width()/2)-4)+"px'></div></div>");
        
    $(document.body).append($arrow);
}


var min_x = 0;
var max_x = 700;
var min_y = 0;
var max_y = 400;
var filled_areas = [];
function check_overlap(area) {
    for (var i = 0; i < filled_areas.length; i++) {
        
        check_area = filled_areas[i];
        
        var bottom1 = area.y + area.height;
        var bottom2 = check_area.y + check_area.height;
        var top1 = area.y;
        var top2 = check_area.y;
        var left1 = area.x;
        var left2 = check_area.x;
        var right1 = area.x + area.width;
        var right2 = check_area.x + check_area.width;
        if (bottom1 < top2 || top1 > bottom2 || right1 < left2 || left1 > right2) {
            continue;
        }
        return true;
    }
    return false;
}
$(function() {

var graph = jsonld['@graph'];
for(var i=0; i<graph.length; i++) {
    var obj = graph[i];
    if(obj['@type'] == 'void:Dataset') {
        var title = obj['title']
        if(title && title['@value']) {
            title = title['@value'];
        }
        var circle = createCircle(title, 1)
        circle.attr('id', obj['@id']);
        $(document.body)
            .append(circle)

        var rand_x=0;
        var rand_y=0;
        var area;
        do {
            rand_x = Math.round(min_x + ((max_x - min_x)*(Math.random() % 1)));
            rand_y = Math.round(min_y + ((max_y - min_y)*(Math.random() % 1)));
            area = {x: rand_x, y: rand_y, width: circle.width(), height: circle.height()};
        } while(check_overlap(area));

        filled_areas.push(area);

        circle.css({
            left:rand_x, 
            top: rand_y
        });

        /*
        // random size
        var min = 70;
        var max = 160;
        // and the formula is:
        var random = Math.floor(Math.random() * (max - min + 1)) + min;
        circle.find('.inner').css({
            width: random,
            height: random

        });
        */

    }
}

// do linkset
for(var i=0; i<graph.length; i++) {
    var obj = graph[i];
    var subject, object;
    if(obj['@type'] == 'void:Linkset') {
        if(obj.target) {
            subject = obj.target[0];
            object = obj.target[1];
        } else if(obj.objectsTarget) {
            subject = obj.subjectsTarget;
            object = obj.objectsTarget
        }
        var subjectCircle = $('[id="'+subject+'"]');
        var objectCircle = $('[id="'+object+'"]');

        connect(subjectCircle, objectCircle, '#0f0', 5);
    }
}


});

</script>
<div id="tmpl" style="display: none">
    <div class="circle"><div class="inner">Music-<br>brainz</div></div>
    <div class="arrow">
        <div class="line"></div>
        <div class="point right"></div>
    </div>
    <!--
    <div class="arrow">
        <div class="line"></div>
        <div class="point right"></div>
        <div class="point left"></div>
    </div>
    -->
</div>

