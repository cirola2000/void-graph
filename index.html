<html>
<head>
<script src="jquery.min.js"></script>

<script src="n3-browser.min.js"></script>
<script src="jsonld.js"></script>

<style>
body {
    font-size: 14px;
    font-family: Tahoma;
}
.circle {
    z-index: 1;
    position: absolute;
    height: 100px;
    width: 100px;
    text-align: center;
    vertical-align: middle;
    border-radius: 50%;
    background: #fff;
    border: 1px solid #316CC3;
    font-size: 14px;
    font-family: Tahoma;

-webkit-box-shadow: 10px 10px 51px -29px rgba(0,0,0,0.75);
-moz-box-shadow: 10px 10px 51px -29px rgba(0,0,0,0.75);
box-shadow: 10px 10px 51px -29px rgba(0,0,0,0.75);
}
.circle .inner
{
    position: absolute;
}
.arrow {
width: 120px;
height: 6px;
position: absolute;

}

.line {
width: 100%;
background: #000;
height: 1px;
top: 50%;
margin-top: -0.5px;
position: absolute;
}
.point {    
width: 0;
height: 0;
border-top: 3px solid transparent;
border-bottom: 3px solid transparent;
border-left: 14px solid #000;
position: absolute;

}
.point.right {
right: -5px;
}
.point.left {
transform: rotate(180deg);
-ms-transform: rotate(180deg);
-webkit-transform: rotate(180deg);
left: -5px;
}
</style>

<script>
function createCircle(text, zoom) {
    var $circle = $('#tmpl .circle').clone();
    var $inner = $circle.find('.inner')
    $inner.text(text);
    $inner.css({
        top: $circle.height() / 2

    });
    return $circle;
}
function getCenter($circle) {
    var pos = $circle.position();

    var width = $circle.width();
    var height = $circle.height();

    return { top: (pos.top + (height / 2)), left: (pos.left + (width/2)) };
}
function connect($c1, $c2, color, thickness) {
    var center1 = getCenter($c1);
    var center2 = getCenter($c2);

    // bottom right
    var x1 = center1.left;
    var y1 = center1.top;
    // top right
    var x2 = center2.left;
    var y2 = center2.top;
    // distance
    var length = Math.sqrt(((x2-x1) * (x2-x1)) + ((y2-y1) * (y2-y1)));
    // center
    var cx = ((x1 + x2) / 2) - (length / 2);
    var cy = ((y1 + y2) / 2) - (thickness / 2);
    // angle
    var angle = Math.atan2((y1-y2),(x1-x2))*(180/Math.PI);
    // make arrow
    var $arrow = $("<div class='arrow' style='z-index:-1;padding:0px; margin:0px; position:absolute; left:" + cx + "px; top:" + cy + "px; width:" + length + "px; -moz-transform:rotate(" + angle + "deg); -webkit-transform:rotate(" + angle + "deg); -o-transform:rotate(" + angle + "deg); -ms-transform:rotate(" + angle + "deg); transform:rotate(" + angle + "deg);'><div class='line'></div><div class='point right' style='right: "+(($c1.width()/2))+"px'></div></div>");
        
    $('#cont').append($arrow);
}


var min_x = 0;
var max_x = 500;
var min_y = 0;
var max_y = 400;
var filled_areas = [];
function check_overlap(area) {
    for (var i = 0; i < filled_areas.length; i++) {
        
        check_area = filled_areas[i];
        
        var bottom1 = area.y + area.height;
        var bottom2 = check_area.y + check_area.height;
        var top1 = area.y;
        var top2 = check_area.y;
        var left1 = area.x;
        var left2 = check_area.x;
        var right1 = area.x + area.width;
        var right2 = check_area.x + check_area.width;
        if (bottom1 < top2 || top1 > bottom2 || right1 < left2 || left1 > right2) {
            continue;
        }
        return true;
    }
    return false;
}
$(function() {

parseTextarea();
function parseTextarea() {
    var parser = N3.Parser();
    var N3Util = N3.Util;
    var ntriples = '';
    parser.parse($('textarea').val(), function (error, triple, prefixes) {
        if(!triple) {
            convertToJsonLD(ntriples);
            return;
        }
        return console.log(triple);
        var object = triple.object;
        if(N3Util.isUri(object)) {
            object = '<' + object + '>';
        }
        ntriples += '<' +triple.subject + '> <' + triple.predicate + '> ' + object + ' .\n'; 
    });
}

function convertToJsonLD(nt) {
    return console.log(nt);

    jsonld.fromRDF(nt, {format: 'application/nquads'}, function(err, doc) {
      // doc is JSON-LD
      parseJsonLd(doc);
    });
}

function parseJsonLd(jsonldDoc) {
    return console.log(jsonldDoc);
    var graph = jsonld['@graph'];
    if(!graph) graph = jsonldDoc;

    filled_areas = []; // reset it otherwise leaks
    for(var i=0; i<graph.length; i++) {
        var obj = graph[i];
        if($.inArray('http://rdfs.org/ns/void#Dataset', obj['@type']) > -1) {
            var title = obj['http://purl.org/dc/terms/title']
            if(title && title.length) {
                title = title[0]['@value'];
            }
            if(!title) {
                title = obj['@id']
            }
            var circle = createCircle(title)
            circle.attr('id', obj['@id']);
            $('#cont')
                .append(circle)

            positionCircle(circle);

        }
    }

    // do linkset
    console.log(JSON.stringify(graph,null,3));
    for(var i=0; i<graph.length; i++) {
        var obj = graph[i];
        var subject, object;
        if($.inArray('http://rdfs.org/ns/void#Linkset', obj['@type']) > -1) {
            if(obj['http://rdfs.org/ns/void#target']) {
                subject = obj['http://rdfs.org/ns/void#target'][0]['@id'];
                object = obj['http://rdfs.org/ns/void#target'][1]['@id'];
            } else if(obj.objectsTarget) {
                subject = obj.subjectsTarget;
                object = obj.objectsTarget
            }
            var subjectCircle = $('[id="'+subject+'"]');
            var objectCircle = $('[id="'+object+'"]');

            connect(subjectCircle, objectCircle, '#0f0', 5);
        }
    }


}

$('button.parse').click(function() {
    $('#cont').html('');
    $('svg').remove();
    parseTextarea();    
});
});

function positionCircle(circle) {
    // random size
    var totalWidth = 0;
    var min = 70;
    var max = 160;
    // and the formula is:
    var random = Math.floor(Math.random() * (max - min + 1)) + min;
    circle.css({
        width: random,
        height: random
    });

    // adjust inner text
    var fontSize = 14 - max;
    var $inner = circle.find('.inner');
    var innerHeight = $inner.height();
    var innerWidth = $inner.width();
    $inner.css({
        top: (circle.height() / 2) - (innerHeight / 2),
        left: (circle.width() / 2) - (innerWidth / 2),
        'font-size': fontSize + 'px'


    });


    // put circle randomly in position
    var rand_x=0;
    var rand_y=0;
    var area;
    do {
        rand_x = Math.round(min_x + ((max_x - min_x)*(Math.random() % 1)));
        rand_y = Math.round(min_y + ((max_y - min_y)*(Math.random() % 1)));
        area = {x: rand_x, y: rand_y, width: circle.width(), height: circle.height()};
    } while(check_overlap(area));

    filled_areas.push(area);

    circle.css({
        left:rand_x, 
        top: rand_y
    });

}

</script>
</head>
<body>
<div id="tmpl" style="display: none">
    <div class="circle"><div class="inner">Music-<br>brainz</div></div>
    <div class="arrow">
        <div class="line"></div>
        <div class="point right"></div>
    </div>
    <!--
    <div class="arrow">
        <div class="line"></div>
        <div class="point right"></div>
        <div class="point left"></div>
    </div>
    -->
</div>
<div style="">
Enter VoID:<br>
<textarea style="width: 600px; height: 300px;">
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix void: <http://rdfs.org/ns/void#> .
@prefix : <http://ex.com/> .

:DBpedia rdf:type void:Dataset ;
         dcterms:title "DBPedia" ;
         foaf:homepage <http://dbpedia.org/> .

:Bio2RDF rdf:type void:Dataset ;
         dcterms:title "Bio2RDF" ;
         foaf:homepage <http://bio2rdf.org/> .

:DBLP rdf:type void:Dataset ;
      dcterms:title "DBLP" ;
      foaf:homepage <http://www4.wiwiss.fu-berlin.de/dblp/all> ;
      dcterms:subject <http://dbpedia.org/resource/Computer_science> ;
      dcterms:subject <http://dbpedia.org/resource/Journal> ;
      dcterms:subject <http://dbpedia.org/resource/Proceedings> .

:DBpedia2DBLP rdf:type void:Linkset ;
              void:target :DBpedia ;
              void:target :DBLP .

:DBpedia2Bio2RDF rdf:type void:Linkset ;
              void:target :DBpedia ;
              void:target :Bio2RDF .
</textarea>
<br>
<button class="parse">parse</button>
</div>
<div style="position:relative;" id="cont"></div>
</body>
</html>

